@using roadcap.recipes.entities.Models

@model Recipe

@{
    ViewData["Title"] = "Edit Recipe";
    var alert = ViewData["alert"] as string;
    var action = ViewData["action"] ?? "Edit";
}

<div class="container body-drop h100">
    <partial name="_Edit.cshtml" model="Model" view-data="ViewData" />
    <div class="row">&nbsp;</div>
    <div class="row justify-content-center align-items-center">

        <div class="col-12 col-md-10 col-lg-8">
            <div class="row"><a asp-action="Add" asp-controller="Ingredients" asp-route-id="@Model.RecipeId">New Ingredient</a></div>
            <div class="row">
                <table id="ingredientsTable" class="table table-bordered table-striped">
                    <thead>
                        <tr>
                            <th>
                                Ingredient
                            </th>
                            <th>
                                Amount
                            </th>
                            <th>
                                Instructions
                            </th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.Ingredients)
                        {
                            <tr id="@("row" + item.IngredientId)">
                                <td>
                                    @Html.DisplayFor(modelItem => item.IngredientName)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.Amount) @Html.DisplayFor(modelItem => item.Units)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.SpecialInstructions)
                                </td>
                                <td>
                                    <a asp-action="Edit" asp-controller="Ingredients" asp-route-id="@item.IngredientId">Edit</a> |
                                    <a id="deleteLink" href="javascript:void(0);" onclick="deleteIngredient(@item.IngredientId)">Delete</a>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>    
    </div>
</div>
@if (alert == "Success")
{
    <div class="toast" data-delay="3000" role="alert" aria-live="assertive" aria-atomic="true" style="position: absolute; top: 70px; right: 10px;">
        <div class="toast-header">
            <strong class="mr-auto">Success!</strong>
            <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="toast-body bg-success text-white">
            Recipe saved successfully!
        </div>
    </div>
}
else if (alert == "Failed")
{
    <div class="toast" data-delay="3000" role="alert" aria-live="assertive" aria-atomic="true" style="position: absolute; top: 70px; right: 10px;">
        <div class="toast-header">
            <strong class="mr-auto">Failed!</strong>
            <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="toast-body bg-danger text-white">
            Recipe failed to save!
        </div>
    </div>
}

@section Scripts
{
    <script>
        function deleteIngredient(id) {
            var r = confirm('Are you sure you want to delete this ingredient?');
            if (r == true) {
                $.ajax({
                    url: 'https://localhost:44356/api/Ingredients/' + id,
                    method: 'DELETE',
                    success: function (data) {
                        //window.location.href = '@Url.Action("Edit", "Recipes", new { id = Model.RecipeId })';
                        $('table#ingredientsTable tr#row' + id).remove();
                    }
                });
            }
        }
    </script>
} 